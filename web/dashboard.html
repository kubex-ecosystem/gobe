<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GHbex - GitHub Repository Analytics & Intelligence</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #0a0e27;
      --bg-secondary: #151933;
      --bg-card: #1e2139;
      --text-primary: #e4e6eb;
      --text-secondary: #9ca3af;
      --accent-blue: #3b82f6;
      --accent-green: #10b981;
      --accent-yellow: #f59e0b;
      --accent-red: #ef4444;
      --accent-purple: #8b5cf6;
      --border: #2d3148;
      --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }

    .header {
      background: linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-card) 100%);
      border-bottom: 1px solid var(--border);
      padding: 1.5rem 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }

    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .logo-icon {
      width: 48px;
      height: 48px;
      background: var(--gradient-1);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.5rem;
      color: white;
    }

    .logo-text h1 {
      font-size: 1.5rem;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logo-text p {
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    .nav-tabs {
      display: flex;
      gap: 1rem;
      background: var(--bg-secondary);
      padding: 0.5rem;
      border-radius: 12px;
    }

    .nav-tab {
      padding: 0.75rem 1.5rem;
      background: transparent;
      border: none;
      color: var(--text-secondary);
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-size: 0.95rem;
      font-weight: 500;
    }

    .nav-tab:hover {
      background: var(--bg-card);
      color: var(--text-primary);
    }

    .nav-tab.active {
      background: var(--gradient-1);
      color: white;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 2rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 1.5rem;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      border-color: var(--accent-blue);
    }

    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: var(--gradient-1);
    }

    .stat-card.green::before {
      background: var(--gradient-4);
    }

    .stat-card.yellow::before {
      background: var(--gradient-2);
    }

    .stat-card.purple::before {
      background: var(--gradient-3);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent-blue) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    .status-indicator {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--accent-green);
    }

    .status-indicator.offline {
      background: var(--accent-red);
    }

    /* AI Enhanced Repository Cards */
    .stat-card.ai-enhanced {
      padding: 1.5rem;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .stat-card.ai-enhanced:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      border-color: var(--accent-blue);
    }

    /* Simulated Data Warning Styles */
    .stat-card.simulated-data {
      padding: 1.5rem;
      background: var(--bg-card);
      border: 2px dashed var(--accent-yellow);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: all 0.3s ease;
      opacity: 0.8;
    }

    .stat-card.simulated-data:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(245, 158, 11, 0.2);
      border-color: var(--accent-red);
      opacity: 1;
    }

    .simulated-warning {
      position: absolute;
      top: -1px;
      left: -1px;
      right: -1px;
      background: var(--accent-yellow);
      color: var(--bg-primary);
      text-align: center;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.25rem;
      border-radius: 12px 12px 0 0;
      z-index: 10;
    }

    .simulated {
      opacity: 0.6;
      text-decoration: line-through;
    }

    .ai-score.simulated {
      background: var(--accent-yellow);
      color: var(--bg-primary);
    }

    .main-tag.simulated,
    .opportunity-tag.simulated {
      opacity: 0.6;
      border-color: var(--accent-yellow);
    }

    .ai-assessment.simulated {
      color: var(--accent-yellow);
      font-style: italic;
    }

    .repo-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 1rem;
    }

    .repo-title {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
      flex: 1;
    }

    .ai-indicators {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .health-icon {
      font-size: 1.2rem;
    }

    .ai-score {
      background: var(--gradient-3);
      color: white;
      padding: 0.2rem 0.6rem;
      border-radius: 8px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .repo-tags {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
      flex-wrap: wrap;
    }

    .main-tag,
    .opportunity-tag {
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .main-tag {
      background: rgba(59, 130, 246, 0.2);
      color: var(--accent-blue);
      border: 1px solid rgba(59, 130, 246, 0.3);
    }

    .opportunity-tag {
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent-green);
      border: 1px solid rgba(16, 185, 129, 0.3);
    }

    .ai-assessment {
      color: var(--text-secondary);
      font-size: 0.85rem;
      line-height: 1.4;
      margin-bottom: 1rem;
    }

    .click-action {
      color: var(--accent-purple);
      font-size: 0.8rem;
      font-weight: 500;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
    }

    .loading-text {
      color: var(--text-secondary);
      font-size: 1rem;
    }

    .error-message {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: 12px;
      padding: 1rem;
      color: var(--accent-red);
      text-align: center;
      margin: 2rem 0;
    }

    .info-message {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 1rem;
      color: var(--accent-blue);
      text-align: center;
      margin: 2rem 0;
    }

    .success-message {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: 12px;
      padding: 1rem;
      color: var(--accent-green);
      text-align: center;
      margin: 2rem 0;
    }

    /* View management */
    .view {
      display: none;
    }

    .view.active {
      display: block;
    }

    /* Configuration Panel */
    .config-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }

    .config-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--text-primary);
    }

    .form-group {
      margin-bottom: 1rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      color: var(--text-secondary);
      font-size: 0.9rem;
      font-weight: 500;
    }

    .form-input {
      width: 100%;
      padding: 0.75rem;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text-primary);
      font-size: 0.9rem;
      transition: border-color 0.3s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent-blue);
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: var(--gradient-1);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-card);
      border-color: var(--accent-blue);
    }

    .btn-danger {
      background: var(--accent-red);
      color: white;
    }

    .btn-danger:hover {
      background: #dc2626;
      transform: translateY(-1px);
    }

    .btn-success {
      background: var(--accent-green);
      color: white;
    }

    .btn-success:hover {
      background: #059669;
      transform: translateY(-1px);
    }

    /* API Testing Panel */
    .endpoint-test {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1rem;
    }

    .endpoint-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .endpoint-method {
      padding: 0.3rem 0.6rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .method-get {
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent-green);
    }

    .method-post {
      background: rgba(59, 130, 246, 0.2);
      color: var(--accent-blue);
    }

    .endpoint-url {
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .response-container {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--bg-secondary);
      border-radius: 8px;
      border: 1px solid var(--border);
    }

    .response-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .response-status {
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .status-200 {
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent-green);
    }

    .status-error {
      background: rgba(239, 68, 68, 0.2);
      color: var(--accent-red);
    }

    .response-body {
      font-family: 'Monaco', 'Menlo', monospace;
      font-size: 0.8rem;
      background: var(--bg-primary);
      padding: 1rem;
      border-radius: 6px;
      border: 1px solid var(--border);
      max-height: 300px;
      overflow-y: auto;
      white-space: pre-wrap;
      color: var(--text-primary);
    }

    /* Repository Intelligence Cards */
    .intelligence-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 1.5rem;
      margin-top: 1.5rem;
    }

    .repo-intelligence-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 1.5rem;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .repo-intelligence-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      border-color: var(--accent-blue);
    }

    .repo-intelligence-card.loading {
      opacity: 0.7;
      pointer-events: none;
    }

    .intelligence-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .repo-name {
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .ai-score-badge {
      padding: 0.3rem 0.8rem;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 600;
      background: var(--gradient-3);
      color: white;
    }

    .intelligence-content {
      color: var(--text-secondary);
      line-height: 1.5;
      margin-bottom: 1rem;
    }

    .intelligence-tags {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .tag {
      padding: 0.2rem 0.6rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-weight: 500;
    }

    .tag-health {
      background: rgba(16, 185, 129, 0.2);
      color: var(--accent-green);
    }

    .tag-risk {
      background: rgba(239, 68, 68, 0.2);
      color: var(--accent-red);
    }

    .tag-opportunity {
      background: rgba(245, 158, 11, 0.2);
      color: var(--accent-yellow);
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 1rem;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .intelligence-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>

<body>
  <header class="header">
    <div class="header-content">
      <div class="logo">
        <div class="logo-icon">GH</div>
        <div class="logo-text">
          <h1>GHbex</h1>
          <p>GitHub Intelligence & Analytics</p>
        </div>
      </div>
      <nav class="nav-tabs">
        <button class="nav-tab active" onclick="switchTab('dashboard')">
          📊 Dashboard
        </button>
        <button class="nav-tab" onclick="switchTab('intelligence')">
          🧠 AI Intelligence
        </button>
        <button class="nav-tab" onclick="switchTab('config')">
          ⚙️ Configuration
        </button>
        <button class="nav-tab" onclick="switchTab('test')">
          � API Testing
        </button>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Dashboard View -->
    <div id="dashboard-view" class="view">
      <div class="stats-grid">
        <div class="stat-card green">
          <div class="status-indicator" id="api-status"></div>
          <div class="stat-value" id="total-repos">-</div>
          <div class="stat-label">Repositórios Disponíveis</div>
        </div>

        <div class="stat-card yellow">
          <div class="stat-value" id="avg-health">-</div>
          <div class="stat-label">Saúde Média dos Repositórios</div>
        </div>

        <div class="stat-card purple">
          <div class="stat-value" id="total-insights">-</div>
          <div class="stat-label">Insights Gerados</div>
        </div>

        <div class="stat-card">
          <div class="stat-value" id="total-recommendations">-</div>
          <div class="stat-label">Recomendações Ativas</div>
        </div>
      </div>

      <div id="status-message" class="info-message">
        🚀 Conectando com servidor GHbex...
      </div>

      <div id="repos-container">
        <!-- Repository data will be loaded here -->
      </div>
    </div>

    <!-- Intelligence View -->
    <div id="intelligence-view" class="view">
      <div class="config-section">
        <div class="config-title">🧠 AI Intelligence Testing</div>
        <div class="form-group">
          <label class="form-label">Repositório para Análise</label>
          <input type="text" class="form-input" id="repo-input" placeholder="rafa-mori/ghbex" value="rafa-mori/gastype">
        </div>
        <button class="btn btn-primary" onclick="testIntelligence()">
          🔍 Analisar Repositório
        </button>
      </div>

      <div id="intelligence-results" class="intelligence-grid">
        <!-- Intelligence results will appear here -->
      </div>
    </div>

    <!-- Configuration View -->
    <div id="config-view" class="view">
      <div class="config-section">
        <div class="config-title">⚙️ API Keys Configuration</div>

        <div class="form-group">
          <label class="form-label">🤖 Gemini API Key</label>
          <input type="password" class="form-input" id="gemini-key" placeholder="AIzaSy...">
          <button class="btn btn-secondary" onclick="testApiKey('gemini')" style="margin-top: 0.5rem;">
            ✅ Testar Conexão
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">🧠 OpenAI API Key</label>
          <input type="password" class="form-input" id="openai-key" placeholder="sk-...">
          <button class="btn btn-secondary" onclick="testApiKey('openai')" style="margin-top: 0.5rem;">
            ✅ Testar Conexão
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">🚀 DeepSeek API Key</label>
          <input type="password" class="form-input" id="deepseek-key" placeholder="sk-...">
          <button class="btn btn-secondary" onclick="testApiKey('deepseek')" style="margin-top: 0.5rem;">
            ✅ Testar Conexão
          </button>
        </div>

        <div class="form-group">
          <label class="form-label">🤖 Claude API Key</label>
          <input type="password" class="form-input" id="claude-key" placeholder="sk-ant-...">
          <button class="btn btn-secondary" onclick="testApiKey('claude')" style="margin-top: 0.5rem;">
            ✅ Testar Conexão
          </button>
        </div>

        <div id="config-status"></div>
      </div>

      <div class="config-section">
        <div class="config-title">🐙 GitHub Configuration</div>

        <div class="form-group">
          <label class="form-label">GitHub Personal Access Token</label>
          <input type="password" class="form-input" id="github-token" placeholder="ghp_...">
        </div>

        <div class="form-group">
          <label class="form-label">Repositórios (separados por vírgula)</label>
          <input type="text" class="form-input" id="repo-list" placeholder="owner/repo1,owner/repo2"
            value="rafa-mori/gastype,rafa-mori/xtui,rafa-mori/logz">
        </div>

        <button class="btn btn-success" onclick="updateConfig()">
          💾 Salvar Configuração
        </button>
      </div>
    </div>

    <!-- API Testing View -->
    <div id="test-view" class="view">
      <div class="endpoint-test">
        <div class="endpoint-header">
          <div>
            <span class="endpoint-method method-get">GET</span>
            <span class="endpoint-url">/health</span>
          </div>
          <button class="btn btn-primary" onclick="testEndpoint('/health', 'GET')">
            🏥 Testar Health
          </button>
        </div>
        <div id="health-response" class="response-container" style="display: none;"></div>
      </div>

      <div class="endpoint-test">
        <div class="endpoint-header">
          <div>
            <span class="endpoint-method method-get">GET</span>
            <span class="endpoint-url">/repos</span>
          </div>
          <button class="btn btn-primary" onclick="testEndpoint('/repos', 'GET')">
            📦 Listar Repositórios
          </button>
        </div>
        <div id="repos-response" class="response-container" style="display: none;"></div>
      </div>

      <div class="endpoint-test">
        <div class="endpoint-header">
          <div>
            <span class="endpoint-method method-get">GET</span>
            <span class="endpoint-url">/intelligence/quick/{owner}/{repo}</span>
          </div>
          <div style="display: flex; gap: 1rem;">
            <input type="text" class="form-input" id="quick-repo" placeholder="rafa-mori/gastype"
              value="rafa-mori/gastype" style="width: 200px;">
            <button class="btn btn-primary" onclick="testQuickIntelligence()">
              � Quick Insight
            </button>
          </div>
        </div>
        <div id="quick-response" class="response-container" style="display: none;"></div>
      </div>

      <div class="endpoint-test">
        <div class="endpoint-header">
          <div>
            <span class="endpoint-method method-get">GET</span>
            <span class="endpoint-url">/analytics/{owner}/{repo}</span>
          </div>
          <div style="display: flex; gap: 1rem;">
            <input type="text" class="form-input" id="analytics-repo" placeholder="rafa-mori/gastype"
              value="rafa-mori/gastype" style="width: 200px;">
            <button class="btn btn-primary" onclick="testAnalytics()">
              📊 Analisar
            </button>
          </div>
        </div>
        <div id="analytics-response" class="response-container" style="display: none;"></div>
      </div>
    </div>
  </main>

  <script>
    // Configuration
    const API_BASE = 'http://localhost:8088';

    // State
    let repos = [];
    let currentView = 'dashboard';
    let apiKeys = {
      gemini: '',
      openai: '',
      deepseek: '',
      claude: ''
    };

    // Initialize the application
    async function init() {
      await checkAPIStatus();
      if (currentView === 'dashboard') {
        await loadDashboard();
      }
      loadStoredConfig();
    }

    // Check if API is available
    async function checkAPIStatus() {
      try {
        const response = await fetch(`${API_BASE}/health`);
        const data = await response.json();

        if (data.status === 'ok') {
          document.getElementById('api-status').classList.remove('offline');
          document.getElementById('status-message').innerHTML =
            '✅ Conectado com GHbex Server - Carregando dados...';
          document.getElementById('status-message').className = 'success-message';
          return true;
        } else {
          throw new Error('API not healthy');
        }
      } catch (error) {
        document.getElementById('api-status').classList.add('offline');
        document.getElementById('status-message').innerHTML =
          '❌ Não foi possível conectar com o servidor GHbex. Verifique se está rodando em localhost:8088';
        document.getElementById('status-message').className = 'error-message';
        return false;
      }
    }

    // Load dashboard data
    async function loadDashboard() {
      try {
        const response = await fetch(`${API_BASE}/repos`);
        const data = await response.json();

        if (data.repositories) {
          repos = data.repositories;
          updateDashboardStats();
          renderRepositories();
          document.getElementById('status-message').style.display = 'none';
          document.getElementById('repos-container').style.display = 'block';
        } else {
          throw new Error('No repositories data');
        }
      } catch (error) {
        console.error('Failed to load repositories:', error);
        document.getElementById('status-message').innerHTML =
          '⚠️ Erro ao carregar dados dos repositórios. Verifique a configuração do GitHub token.';
        document.getElementById('status-message').className = 'error-message';
      }
    }

    // Update dashboard statistics
    function updateDashboardStats() {
      document.getElementById('total-repos').textContent = repos.length;

      // Calculate average AI score
      const aiScores = repos.map(repo => repo.ai?.score || 0).filter(score => score > 0);
      const avgScore = aiScores.length > 0 ?
        (aiScores.reduce((a, b) => a + b, 0) / aiScores.length).toFixed(1) : '--';
      document.getElementById('avg-health').textContent = avgScore;

      // Count AI providers (mock for now)
      document.getElementById('ai-providers').textContent = '6';

      // Count total insights
      document.getElementById('total-insights').textContent = repos.length * 3;
    }

    // Render repositories list
    function renderRepositories() {
      const container = document.getElementById('repos-container');

      if (repos.length === 0) {
        container.innerHTML = `
          <div class="info-message">
            📦 Nenhum repositório configurado. Adicione repositórios na aba Configuration.
          </div>
        `;
        return;
      }

      const repoCards = repos.map(repo => {
        const healthIcon = repo.ai?.health_icon || '🔴';
        const aiScore = repo.ai?.score || 0;
        const assessment = repo.ai?.assessment || 'Análise não disponível';
        const mainTag = repo.ai?.main_tag || '📦 Repository';
        const riskLevel = repo.ai?.risk_level || 'unknown';

        return `
          <div class="stat-card ai-enhanced" onclick="analyzeRepository('${repo.owner}/${repo.name}')">
            <div class="repo-header">
              <div class="repo-title">${repo.owner}/${repo.name}</div>
              <div class="ai-indicators">
                <span class="health-icon">${healthIcon}</span>
                <span class="ai-score">${aiScore.toFixed(1)}</span>
              </div>
            </div>
            <div class="repo-tags">
              <span class="main-tag">${mainTag}</span>
              <span class="opportunity-tag risk-${riskLevel}">${repo.ai?.opportunity || 'Optimization available'}</span>
            </div>
            <div class="ai-assessment">${assessment}</div>
            <div class="click-action">🔍 Clique para análise detalhada</div>
          </div>
        `;
      }).join('');

      container.innerHTML = `
        <h2 style="margin-bottom: 1.5rem; color: var(--text-primary);">📦 Repositórios Configurados</h2>
        <div class="stats-grid">
          ${repoCards}
        </div>
      `;
    }

    // Analyze specific repository
    async function analyzeRepository(repoName) {
      const [owner, repo] = repoName.split('/');

      document.getElementById('status-message').innerHTML =
        `🔍 Analisando ${repoName}...`;
      document.getElementById('status-message').className = 'info-message';
      document.getElementById('status-message').style.display = 'block';

      try {
        const response = await fetch(`${API_BASE}/intelligence/quick/${owner}/${repo}`);
        const data = await response.json();

        if (response.ok) {
          document.getElementById('status-message').innerHTML =
            `✅ Análise de ${repoName} concluída com score ${data.ai_score?.toFixed(1) || '0.0'}!`;
          document.getElementById('status-message').className = 'success-message';

          // Update the repository card with new data
          await loadDashboard();
        } else {
          throw new Error(data.error || 'Análise falhou');
        }
      } catch (error) {
        console.error('Analysis failed:', error);
        document.getElementById('status-message').innerHTML =
          `❌ Erro na análise de ${repoName}: ${error.message}`;
        document.getElementById('status-message').className = 'error-message';
      }
    }

    // Switch between tabs
    function switchTab(tab) {
      // Update nav tabs
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');

      // Update views
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(`${tab}-view`).classList.add('active');

      currentView = tab;

      // Load data for the active tab
      if (tab === 'dashboard') {
        loadDashboard();
      }
    }

    // Test Intelligence endpoint
    async function testIntelligence() {
      const repoInput = document.getElementById('repo-input').value.trim();
      if (!repoInput) {
        alert('Por favor, insira um repositório (ex: owner/repo)');
        return;
      }

      const [owner, repo] = repoInput.split('/');
      if (!owner || !repo) {
        alert('Formato inválido. Use: owner/repo');
        return;
      }

      const resultsContainer = document.getElementById('intelligence-results');
      resultsContainer.innerHTML = `
        <div class="repo-intelligence-card loading">
          <div class="intelligence-header">
            <div class="repo-name">${repoInput}</div>
            <div class="ai-score-badge">Analisando...</div>
          </div>
          <div class="intelligence-content">🔍 Executando análise de IA...</div>
        </div>
      `;

      try {
        const response = await fetch(`${API_BASE}/intelligence/quick/${owner}/${repo}`);
        const data = await response.json();

        if (response.ok) {
          resultsContainer.innerHTML = `
            <div class="repo-intelligence-card">
              <div class="intelligence-header">
                <div class="repo-name">${repoInput}</div>
                <div class="ai-score-badge">${data.ai_score?.toFixed(1) || '0.0'}</div>
              </div>
              <div class="intelligence-content">
                ${data.quick_assessment || 'Análise não disponível'}
              </div>
              <div class="intelligence-tags">
                <span class="tag tag-health">${data.health_icon || '🔴'} ${data.main_tag || 'Repository'}</span>
                <span class="tag tag-risk">Risk: ${data.risk_level || 'unknown'}</span>
                <span class="tag tag-opportunity">${data.opportunity || 'Optimization available'}</span>
              </div>
            </div>
          `;
        } else {
          throw new Error(data.error || 'Análise falhou');
        }
      } catch (error) {
        resultsContainer.innerHTML = `
          <div class="error-message">
            ❌ Erro na análise: ${error.message}
          </div>
        `;
      }
    }

    // Test API Key functionality
    async function testApiKey(provider) {
      const keyInput = document.getElementById(`${provider}-key`);
      const key = keyInput.value.trim();

      if (!key) {
        alert(`Por favor, insira a API key do ${provider.toUpperCase()}`);
        return;
      }

      const statusDiv = document.getElementById('config-status');
      statusDiv.innerHTML = `
        <div class="info-message">
          🔍 Testando conexão com ${provider.toUpperCase()}...
        </div>
      `;

      // Simulate API key test (in real implementation, this would call the backend)
      setTimeout(() => {
        if (key.length > 10) {
          statusDiv.innerHTML = `
            <div class="success-message">
              ✅ ${provider.toUpperCase()} API key válida! Conexão estabelecida.
            </div>
          `;
          apiKeys[provider] = key;
          localStorage.setItem(`ghbex_${provider}_key`, key);
        } else {
          statusDiv.innerHTML = `
            <div class="error-message">
              ❌ ${provider.toUpperCase()} API key inválida. Verifique o formato.
            </div>
          `;
        }
      }, 1500);
    }

    // Update configuration
    function updateConfig() {
      const githubToken = document.getElementById('github-token').value.trim();
      const repoList = document.getElementById('repo-list').value.trim();

      if (githubToken) {
        localStorage.setItem('ghbex_github_token', githubToken);
      }

      if (repoList) {
        localStorage.setItem('ghbex_repo_list', repoList);
      }

      document.getElementById('config-status').innerHTML = `
        <div class="success-message">
          💾 Configuração salva! Reinicie o servidor para aplicar as mudanças.
        </div>
      `;
    }

    // Load stored configuration
    function loadStoredConfig() {
      const storedKeys = ['gemini', 'openai', 'deepseek', 'claude'];
      storedKeys.forEach(provider => {
        const storedKey = localStorage.getItem(`ghbex_${provider}_key`);
        if (storedKey) {
          document.getElementById(`${provider}-key`).value = storedKey;
          apiKeys[provider] = storedKey;
        }
      });

      const githubToken = localStorage.getItem('ghbex_github_token');
      if (githubToken) {
        document.getElementById('github-token').value = githubToken;
      }

      const repoList = localStorage.getItem('ghbex_repo_list');
      if (repoList) {
        document.getElementById('repo-list').value = repoList;
      }
    }

    // Test endpoints functionality
    async function testEndpoint(endpoint, method) {
      const responseId = endpoint.replace(/[^a-zA-Z]/g, '');
      const responseContainer = document.getElementById(`${responseId === 'health' ? 'health' : responseId === 'repos' ? 'repos' : 'health'}-response`);

      responseContainer.style.display = 'block';
      responseContainer.innerHTML = `
        <div class="response-header">
          <span>Response</span>
          <span class="response-status">Loading...</span>
        </div>
        <div class="response-body">Executando requisição...</div>
      `;

      try {
        const response = await fetch(`${API_BASE}${endpoint}`, { method });
        const data = await response.json();

        responseContainer.innerHTML = `
          <div class="response-header">
            <span>Response</span>
            <span class="response-status status-${response.ok ? '200' : 'error'}">${response.status}</span>
          </div>
          <div class="response-body">${JSON.stringify(data, null, 2)}</div>
        `;
      } catch (error) {
        responseContainer.innerHTML = `
          <div class="response-header">
            <span>Response</span>
            <span class="response-status status-error">Error</span>
          </div>
          <div class="response-body">Error: ${error.message}</div>
        `;
      }
    }

    // Test Quick Intelligence endpoint
    async function testQuickIntelligence() {
      const repoInput = document.getElementById('quick-repo').value.trim();
      if (!repoInput) {
        alert('Por favor, insira um repositório');
        return;
      }

      const [owner, repo] = repoInput.split('/');
      if (!owner || !repo) {
        alert('Formato inválido. Use: owner/repo');
        return;
      }

      await testEndpoint(`/intelligence/quick/${owner}/${repo}`, 'GET');

      // Show response in quick-response container
      const responseContainer = document.getElementById('quick-response');
      responseContainer.style.display = 'block';
    }

    // Test Analytics endpoint
    async function testAnalytics() {
      const repoInput = document.getElementById('analytics-repo').value.trim();
      if (!repoInput) {
        alert('Por favor, insira um repositório');
        return;
      }

      const [owner, repo] = repoInput.split('/');
      if (!owner || !repo) {
        alert('Formato inválido. Use: owner/repo');
        return;
      }

      const responseContainer = document.getElementById('analytics-response');
      responseContainer.style.display = 'block';
      responseContainer.innerHTML = `
        <div class="response-header">
          <span>Response</span>
          <span class="response-status">Loading...</span>
        </div>
        <div class="response-body">Executando análise...</div>
      `;

      try {
        const response = await fetch(`${API_BASE}/analytics/${owner}/${repo}`);
        const data = await response.json();

        responseContainer.innerHTML = `
          <div class="response-header">
            <span>Response</span>
            <span class="response-status status-${response.ok ? '200' : 'error'}">${response.status}</span>
          </div>
          <div class="response-body">${JSON.stringify(data, null, 2)}</div>
        `;
      } catch (error) {
        responseContainer.innerHTML = `
          <div class="response-header">
            <span>Response</span>
            <span class="response-status status-error">Error</span>
          </div>
          <div class="response-body">Error: ${error.message}</div>
        `;
      }
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', init);


    // Calculate average health (placeholder for now)
    document.getElementById('avg-health').textContent = '45.7';

    // Placeholder stats
    document.getElementById('total-insights').textContent = repos.length * 3;
    document.getElementById('total-recommendations').textContent = repos.length * 2;


    // Render repositories list (corrected version)
    function renderRepositories() {
      const container = document.getElementById('repos-container');

      if (repos.length === 0) {
        container.innerHTML = `
  <div class="info-message">
    📦 Nenhum repositório configurado. Adicione repositórios na aba Configuration.
  </div>
  `;
        return;
      }

      const repoCards = repos.map(repo => {
        const healthIcon = repo.ai?.health_icon || '�';
        const aiScore = repo.ai?.score || 0;
        const assessment = repo.ai?.assessment || 'Análise não disponível';
        const mainTag = repo.ai?.main_tag || '📦 Repository';
        const riskLevel = repo.ai?.risk_level || 'unknown';

        return `
  <div class="stat-card ai-enhanced" onclick="analyzeRepository('${repo.owner}/${repo.name}')">
    <div class="repo-header">
      <div class="repo-title">${repo.owner}/${repo.name}</div>
      <div class="ai-indicators">
        <span class="health-icon">${healthIcon}</span>
        <span class="ai-score">${aiScore.toFixed(1)}</span>
      </div>
    </div>
    <div class="repo-tags">
      <span class="main-tag">${mainTag}</span>
      <span class="opportunity-tag risk-${riskLevel}">${repo.ai?.opportunity || 'Optimization available'}</span>
    </div>
    <div class="ai-assessment">${assessment}</div>
    <div class="click-action">🔍 Clique para análise detalhada</div>
  </div>
  `;
      }).join('');

      container.innerHTML = `
  <h2 style="margin-bottom: 1.5rem; color: var(--text-primary);">📦 Repositórios Configurados</h2>
  <div class="stats-grid">
    ${repoCards}
  </div>
  `;
      // Analyze specific repository
      async function analyzeRepository(repoName) {
        const [owner, repo] = repoName.split('/');

        document.getElementById('status-message').innerHTML =
          `🔍 Analisando ${repoName}...`;
        document.getElementById('status-message').className = 'info-message';
        document.getElementById('status-message').style.display = 'block';

        try {
          const response = await fetch(`${API_BASE}/intelligence/quick/${owner}/${repo}`);
          const data = await response.json();

          if (response.ok) {
            document.getElementById('status-message').innerHTML =
              `✅ Análise de ${repoName} concluída com score ${data.ai_score?.toFixed(1) || '0.0'}!`;
            document.getElementById('status-message').className = 'success-message';

            // Update the repository card with new data
            await loadDashboard();
          } else {
            throw new Error(data.error || 'Análise falhou');
          }
        } catch (error) {
          console.error('Analysis failed:', error);
          document.getElementById('status-message').innerHTML =
            `❌ Erro na análise de ${repoName}: ${error.message}`;
          document.getElementById('status-message').className = 'error-message';
        }
      }
    }

    // Switch between tabs
    function switchTab(tab) {
      // Update nav tabs
      document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');

      // Update views
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(`${tab}-view`).classList.add('active');

      currentView = tab;

      // Load data for the active tab
      if (tab === 'dashboard') {
        loadDashboard();
      }
    }

    // Initialize when page loads
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>

</html>
