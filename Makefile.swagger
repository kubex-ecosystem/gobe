# KbxCtl Swagger Makefile

.PHONY: swagger-deps swagger-gen swagger-serve swagger-clean swagger-build help

# Default target
help: ## Show this help message
	@echo "KbxCtl Swagger Documentation"
	@echo "=============================="
	@awk 'BEGIN {FS = ":.*?## "} /^[a-zA-Z_-]+:.*?## / {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)

swagger-deps: ## Install Swagger dependencies
	@echo "ğŸ“¦ Installing Swagger dependencies..."
	go mod tidy
	go install github.com/swaggo/swag/cmd/swag@latest

swagger-gen: ## Generate Swagger documentation
	@echo "ğŸ“š Generating Swagger documentation..."
	swag init -g cmd/swagger/main.go -o docs/ --parseDependency --parseInternal

swagger-build: swagger-gen ## Build Swagger server
	@echo "ğŸ”¨ Building Swagger server..."
	go build -o bin/kbxctl-swagger cmd/swagger/main.go

swagger-serve: swagger-gen ## Run Swagger server
	@echo "ğŸš€ Starting KbxCtl API server with Swagger docs..."
	@echo "ğŸ“š Swagger UI: http://localhost:8080/swagger/index.html"
	@echo "ğŸ” API Root: http://localhost:8080/"
	go run cmd/swagger/main.go

swagger-clean: ## Clean generated files
	@echo "ğŸ§¹ Cleaning generated Swagger files..."
	rm -rf docs/docs.go docs/swagger.json docs/swagger.yaml
	rm -f bin/kbxctl-swagger

swagger-validate: swagger-gen ## Validate Swagger documentation
	@echo "âœ… Validating Swagger documentation..."
	@if [ -f docs/swagger.json ]; then \
		echo "swagger.json generated successfully"; \
	else \
		echo "âŒ swagger.json not found"; \
		exit 1; \
	fi

swagger-info: ## Show Swagger information
	@echo "ğŸ“‹ KbxCtl Swagger Information"
	@echo "=============================="
	@echo "Version: 1.0"
	@echo "Title: KbxCtl API"
	@echo "Description: A powerful CLI tool API for Kubernetes, LLM providers, and Agent management"
	@echo ""
	@echo "Endpoints:"
	@echo "  - Agents Management: /api/agents/*"
	@echo "  - LLM Providers: /api/llm/*"
	@echo "  - Kubernetes: /api/v1/*"
	@echo "  - Health: /health"
	@echo ""
	@echo "Documentation: /swagger/index.html"

# Development shortcuts
dev: swagger-serve ## Alias for swagger-serve

docs: swagger-gen ## Alias for swagger-gen

build: swagger-build ## Alias for swagger-build

clean: swagger-clean ## Alias for swagger-clean
